/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable experimental features for better code splitting
  experimental: {
    optimizePackageImports: [
      'react-icons',
      'lucide-react',
      '@mui/material',
      'framer-motion',
    ],
    // Enable Turbopack file system caching for faster builds
    turbopackFileSystemCacheForDev: true,
  },
  
  // Turbopack configuration (Next.js 16 default)
  // Note: We don't alias Node.js modules because:
  // 1. fs and crypto are needed on the server (API routes, SSR)
  // 2. Turbopack automatically handles excluding server-only modules from client bundles
  // 3. Aliasing them breaks server-side code that legitimately needs these modules
  turbopack: {},
  
  // Compiler optimizations
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production' ? {
      exclude: ['error', 'warn'],
    } : false,
  },
  
  images: {
    formats: ['image/avif', 'image/webp'],
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'techcrunch.com',
      },
      {
        protocol: 'https',
        hostname: 'randomuser.me',
      },
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'picsum.photos',
      },
      {
        protocol: 'https',
        hostname: 'gwjpmypuqmmoqcjyufln.supabase.co',
      },
      {
        protocol: 'https',
        hostname: 'via.placeholder.com',
      },
      {
        protocol: 'https',
        hostname: 'i.pravatar.cc', // âœ… added for avatar images
      },
      // ðŸ‘‡ Common avatar / auth image sources
      {
        protocol: "https",
        hostname: "lh3.googleusercontent.com", // Google
      },
      {
        protocol: "https",
        hostname: "avatars.githubusercontent.com", // GitHub
      },
      {
        protocol: "https",
        hostname: "platform-lookaside.fbsbx.com", // Facebook
      },
      {
        protocol: "https",
        hostname: "cdn.discordapp.com", // Discord avatars
      },
      {
        protocol: "https",
        hostname: "api.dicebear.com", // DiceBear placeholder avatars
      },
      {
        protocol: "https",
        hostname: "cdn-icons-png.flaticon.com", // Flaticon icons
      },
      {
        protocol: "https",
        hostname: "media.istockphoto.com",
      },
      {
        protocol: "https",
        hostname: "www.istockphoto.com",
      },
    ],
  },
  
  // Exclude large directories from serverless function bundles
  // These files are read at runtime via fs, not bundled
  outputFileTracingExcludes: {
    '*': [
      'android/**/*',
      'data/AllState/**/*',
      'public/AllStates/**/*',
      'public/notices_*.zip',
      'public/*.csv',
      'public/*.pdf',
      'public/*.xlsx',
      'public/Gemini_Generated_Image*.png',
      'public/banners/**/*',
    ],
  },
};

export default nextConfig;
